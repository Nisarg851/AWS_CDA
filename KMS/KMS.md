<h1> Things to do </h1>

- Provide date on which the document was last edited
- Provide reference for the information
- Provide video link for the hands-on labs
---

- [Introduction](#introduction)
- [Core Concepts](#core-concepts)
    - [Customer Master Keys (CMKs)](#customer-master-keys-cmks)
    - [Encryption Context](#encryption-context)
    - [Data Keys](#data-keys)
- [Types of Keys](#types-of-keys)
    - [AWS Managed Keys](#aws-managed-keys)
    - [Customer Managed Keys](#customer-managed-keys)
    - [AWS Owned Keys](#aws-owned-keys)
- [Integrating KMS with AWS Services](#integrating-kms-with-aws-services)
- [Security and Access Control](#security-and-access-control)
    - [Key Policies](#key-policies)
    - [IAM Policies and Grants](#iam-policies-and-grants)
- [Monitoring and Auditing](#monitoring-and-auditing)
    - [CloudTrail Logs](#cloudtrail-logs)
    - [CloudWatch Metrics](#cloudwatch-metrics)
- [Use Cases](#use-cases)
    - [Data Encryption at Rest](#data-encryption-at-rest)
    - [Database Encryption](#database-encryption)
    - [Envelope Encryption](#envelope-encryption)
- [Pricing](#pricing)
- [Best Practices](#best-practices)
    - [Use Separate Keys for Different Use Cases](#use-separate-keys-for-different-use-cases)
    - [Enable Key Rotation](#enable-key-rotation)
    - [Implement Fine-Grained Key Policies](#implement-fine-grained-key-policies)
    - [Monitor Key Usage](#monitor-key-usage)
    - [Use Encryption Context for Additional Security](#use-encryption-context-for-additional-security)
- [Troubleshooting Common Issues](#troubleshooting-common-issues)
    - [Access Denied Errors](#access-denied-errors)
    - [Key Deletion Delay](#key-deletion-delay)
    - [Failed Decryption Requests](#failed-decryption-requests)
- [Resources](#resources)

---

# Introduction

- **AWS Key Management Service (KMS)** is a fully managed service that allows you to create, control, and manage cryptographic keys for secure data encryption across AWS services and applications.
- KMS uses a centralized key management approach, enabling easy integration with AWS services like S3, RDS, DynamoDB, and Lambda.

# Core Concepts

### Customer Master Keys (CMKs)
- **Customer Master Keys (CMKs)** are logical resources that KMS manages to encrypt and decrypt data. They are the primary keys that control the encryption and decryption processes for various data.
- CMKs never leave KMS and are stored securely within the KMS hardware security modules (HSMs).

### Encryption Context
- **Encryption Context** is an optional, non-secret key-value pair used for additional data integrity in encryption requests.
- Itâ€™s a way to apply context or metadata to encrypted data, allowing for better control over decryption requirements.

### Data Keys
- **Data Keys** are generated by KMS and used to encrypt large amounts of data outside KMS.
- KMS handles the encryption of Data Keys using CMKs, and applications can use Data Keys to encrypt bulk data.

# Types of Keys

### AWS Managed Keys
- Automatically created and managed by AWS for use with specific AWS services (e.g., S3, EBS).
- Simplifies management but offers limited control over rotation and key policies.

### Customer Managed Keys
- Created, managed, and controlled by the customer, providing more flexibility in access control, rotation, and usage monitoring.
- Allows setting policies, defining key rotation, and managing permissions for users and roles.

### AWS Owned Keys
- Used internally by AWS and shared across AWS accounts. AWS-owned keys cannot be managed or viewed by users directly.
- Suitable for scenarios where encryption is automatically handled by AWS without direct customer interaction.

# Integrating KMS with AWS Services

KMS integrates with several AWS services for encryption and decryption needs:

- **Amazon S3**: Encrypt objects within buckets using KMS keys.
- **Amazon EBS**: Securely encrypt volumes and snapshots at rest.
- **AWS Lambda**: Encrypt environment variables and sensitive data for function invocations.
- **AWS RDS**: Encrypt database instances and snapshots.
- **CloudTrail**: Log encryption/decryption activity within an account.

# Security and Access Control

### Key Policies
- **Key Policies** define who can access and manage CMKs and their operations.
- Can be defined at key creation and adjusted to specify which users or roles can access, modify, or delete a key.

### IAM Policies and Grants
- **IAM Policies** allow assigning access permissions to KMS for specific users or roles within an account.
- **Grants** enable temporary permissions for KMS keys and can be used to delegate access without changing the key policy.

# Monitoring and Auditing

### CloudTrail Logs
- **CloudTrail** logs all key management activities, including key creation, deletion, encryption, and decryption events.

### CloudWatch Metrics
- **CloudWatch** monitors KMS API requests, giving insights into API call frequency, errors, latency, and utilization.

# Use Cases

### Data Encryption at Rest
- KMS can encrypt sensitive data stored in AWS services, ensuring that data is only accessible through authorized decryption requests.

### Database Encryption
- Encrypt databases in RDS, Aurora, and DynamoDB to secure sensitive information and enforce regulatory compliance.

### Envelope Encryption
- Combine KMS with client-side libraries to manage encrypted data locally by splitting encryption responsibilities.

# Pricing

- KMS charges for the number of keys stored and the number of cryptographic operations (e.g., encryptions, decryptions).
- Charges may vary based on the KMS key usage frequency, region, and API requests for encryption/decryption.

# Best Practices

### Use Separate Keys for Different Use Cases
- Create different CMKs for different applications or departments, ensuring segmented encryption management.

### Enable Key Rotation
- Enable automatic key rotation for Customer Managed Keys to enhance data security and minimize key management overhead.

### Implement Fine-Grained Key Policies
- Control access to keys at a granular level, following the **principle of least privilege** for all users and roles.

### Monitor Key Usage
- Regularly review CloudTrail logs and CloudWatch metrics to ensure appropriate key usage and identify unauthorized access attempts.

### Use Encryption Context for Additional Security
- Add an encryption context to all KMS requests to enhance data integrity and prevent unauthorized decryption.

# Troubleshooting Common Issues

### Access Denied Errors
- Verify that both the **key policy** and **IAM policies** grant access permissions to the user or role attempting the action.

### Key Deletion Delay
- CMKs are not deleted immediately but enter a scheduled deletion phase for a configurable period (default 30 days). Use the **CancelKeyDeletion** API to prevent accidental deletions.

### Failed Decryption Requests
- Ensure that the correct CMK and encryption context are used in the decryption request. KMS will reject decryption if the encryption context does not match.

---

# Resources

- [AWS KMS Documentation](https://docs.aws.amazon.com/kms/latest/developerguide/)
- [AWS KMS Key Management Best Practices](https://docs.aws.amazon.com/kms/latest/developerguide/best-practices.html)
- [AWS Security Blog - Using KMS for Data Protection](https://aws.amazon.com/blogs/security/)
- [AWS Notes by Tahseer](https://arkalim.notion.site/Notes-143374c83daa4d4991b07400056a2aa9)